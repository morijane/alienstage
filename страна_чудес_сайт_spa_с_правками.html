<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Страна Чудес — уровни 1–3</title>
<style>
  :root{
    --bg:#0b0b0b;
    --text:#d2d2d2;      /* серый основной */
    --accent:#ff69b4;    /* розовый акцент */
    --ok:#59ff9a;
    --err:#ff5566;
    --muted:#9a9a9a;
    --border:#333;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{ margin:0; background:var(--bg); color:var(--text);
        font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
        display:flex; align-items:center; justify-content:center; padding:24px; }
  .crt{ width:min(980px,100%); min-height:80vh; border:2px solid var(--border); border-radius:16px; padding:24px; box-shadow:0 0 40px rgba(255,105,180,.08) inset; }
  .header{ color:var(--accent); margin-bottom:12px; letter-spacing:.06em; }
  .screen{ display:none; animation: fade .2s ease-out; }
  .screen.active{ display:block; }
  @keyframes fade{ from{opacity:.4} to{opacity:1} }
  .type{ white-space:pre-wrap; line-height:1.45; min-height:140px; }
  .btn{ background:#141414; color:var(--accent); border:1px solid var(--accent); padding:10px 16px; border-radius:10px; cursor:pointer; font:inherit; }
  .btn:disabled{ opacity:.6; cursor:not-allowed; }
  .muted{ color:var(--muted); }
  hr{ border:none; border-top:1px solid var(--border); margin:16px 0; }

  /* LEVEL 1 (символьная перестановка) */
  .symbols{ display:flex; gap:10px; margin:12px 0; }
  .symbol{ width:56px; height:56px; display:flex; align-items:center; justify-content:center; font-size:28px; border:2px solid var(--accent); background:#121212; border-radius:10px; cursor:pointer; user-select:none; }

  /* LEVEL 2 (логическая таблица чая) */
  table{ border-collapse:collapse; width:100%; max-width:640px; }
  th, td{ border:1px solid var(--border); padding:10px; text-align:center; }
  th{ color:var(--accent); font-weight:600; }
  select{ background:#121212; color:var(--text); border:1px solid var(--accent); border-radius:8px; padding:6px; font:inherit; }

  /* LEVEL 3 (лабиринт) */
  .maze{ border-collapse:collapse; margin:8px 0; }
  .maze td{ width:50px; height:50px; border:1px solid var(--border); cursor:pointer; text-align:center; font-size:22px; }
  .path{ background:#112d11; }
  .wrong{ background:#2d1111; }
  #timer{ color:#ffd166; margin:6px 0; }

  details{ border:1px solid var(--border); border-radius:10px; padding:10px; margin:10px 0; background:#0f0f0f; }
  summary{ color:var(--accent); cursor:pointer; }
</style>
</head>
<body>
<div class="crt">
  <div class="header">WONDERLAND// VIVINOS TERMINAL EMULATOR</div>

  <!-- SCREEN 1: index -->
  <section id="s1" class="screen active">
    <div class="type" id="t1"></div>
    <div id="c1"></div>
  </section>

  <!-- SCREEN 2: LEVEL 1 (первая головоломка) -->
  <section id="s2" class="screen">
    <div class="type" id="t2"></div>
    <div id="lvl1" style="opacity:.35; pointer-events:none;">
      <div class="symbols" id="symbols"></div>
      <button class="btn" id="btnCheck1">Проверить</button>
      <div id="msg1" class="muted"></div>
    </div>
  </section>

  <!-- SCREEN 3: STORY 1 -->
  <section id="s3" class="screen">
    <div class="type" id="t3"></div>
    <div id="c3"></div>
  </section>

  <!-- SCREEN 4: LEVEL 2 (логика чаепития) -->
  <section id="s4" class="screen">
    <div class="type" id="t4"></div>
    <div id="lvl2" style="opacity:.35; pointer-events:none;">
      <table>
        <tr><th>Гость</th><th>Чай</th></tr>
        <tr><td>Белый кролик</td><td><select id="guest1"><option value="">---</option><option>Мятный</option><option>Черный</option><option>Ягодный</option><option>Лимонный</option><option>Зеленый</option></select></td></tr>
        <tr><td>Чеширский кот</td><td><select id="guest2"><option value="">---</option><option>Мятный</option><option>Черный</option><option>Ягодный</option><option>Лимонный</option><option>Зеленый</option></select></td></tr>
        <tr><td>Королева</td><td><select id="guest3"><option value="">---</option><option>Мятный</option><option>Черный</option><option>Ягодный</option><option>Лимонный</option><option>Зеленый</option></select></td></tr>
        <tr><td>Безумный Шляпник</td><td><select id="guest4"><option value="">---</option><option>Мятный</option><option>Черный</option><option>Ягодный</option><option>Лимонный</option><option>Зеленый</option></select></td></tr>
        <tr><td>Мартовский Заяц</td><td><select id="guest5"><option value="">---</option><option>Мятный</option><option>Черный</option><option>Ягодный</option><option>Лимонный</option><option>Зеленый</option></select></td></tr>
      </table>
      <button class="btn" id="btnCheck2">Проверить</button>
      <div id="msg2" class="muted"></div>
    </div>
  </section>

  <!-- SCREEN 5: STORY 2 -->
  <section id="s5" class="screen">
    <div class="type" id="t5"></div>
    <div id="c5"></div>
  </section>

  <!-- SCREEN 6: LEVEL 3 (лабиринт) -->
  <section id="s6" class="screen">
    <div class="type" id="t6"></div>
    <div id="lvl3" style="opacity:.35; pointer-events:none;">
      <div id="timer"></div>
      <table class="maze" id="maze"></table>
      <div id="msg3" class="muted"></div>
    </div>
  </section>

  <!-- SCREEN 7: STORY 3 (финал блока) -->
  <section id="s7" class="screen">
    <div class="type" id="t7"></div>
    <div id="c7"></div>
  </section>

  <!-- SCREEN 8: ДНЕВНИКИ АЛИСЫ -->
  <section id="s8" class="screen">
    <h2 style="color:var(--accent); margin-top:0;">ДНЕВНИКИ АЛИСЫ</h2>
    <div id="diaries"></div>
  </section>
</div>

<script>
// ---------- Текстовые блоки ----------
const text1 = `Добро пожаловать в Страну Чудес.\nТеперь ты в безопасности. Никто не обидит тебя.\nСледуй за кроликом и все будет хорошо.\n\nЕсли вас тут трое, нажми Продолжить`;

const pre2 = `Тебе надо освоиться в Стране Чудес и научиться здесь существовать. Все будет хорошо!`;

const text3 = `Чем вас больше в Стране Чудес – тем лучше вам будет тут!\n\n“Где находится Страна Чудес? Это место на серверах в лаборатории Наступающего Шторма внутри системы VIVINOS.\nЧто такое система VIVINOS? \nЭто суперкомпьютер, который контролирует цивилизацию Оверлордов. Кажется, что они пришли из другой реальности. Такой же Земли как наша? Наверное, ведь я знаю, что они – люди. Редкий Гранит снял передо мной маску, показал свое лицо – он обычный старик. Я сказала об этом Дель Сол и мы договорились вместе раскрыть правду …” \n\n“Питомец Алмаза… больше, чем питомец. Старые записи неточные. Алмаз относился к нему как к любовнику. Может, и любил. И взревновал, когда Раджа начали любить все. Не справился. Забил, как зверь. Умеют ли Оверлорды привязываться? Было ли Алмазу больно?”\n\n“Попытка оцифровать все еще неуспешныые. Сознание Наны поглотить не удалось, но она так хотела победить. Сознание Катце смутное — как при отравлении. Мысли считать не вышло. Продолжаю эксперименты.”\n\nЕсли вас тут четверо, нажми Продолжить`;

const pre4 = `Наша с тобой вторая головоломка.
Используй вот эти подсказки.

Белый кролик не пьет черный чай. Белый кролик не пьет ягодный чай, если Чеширский кот не пьет зеленый.

Чеширский кот пьет чай, который не зеленый и не мятный.

Лимонный чай пьет Мартовский Заяц.

Безумный Шляпник не пьет мятный чай, если Королева пьет зеленый.

Королева пьет не ягодный чай. Королева пьет не черный чай, если Чеширский кот пьет зеленый.`;

const text5 = `Система VIVINOS подключена к каждому Оверлорду и питомцу. Она заряжается от эмоций. Поэтому им нужны мы - они же давно ничего не чувствуют … им всем сотни лет … опыты превратили их в монстров …\n\nДля этого и нужен Alien Stage! Каждый год система синхронизируется с другим миром. Это позволяет им оставаться в нашем мире … порабощать их …\n\nДель Сол … я любила её … почему она не поддержала меня? Наверное потому, что она знала – что победить Оверлордов невозможно …\n\nВы можете слышать, что происходит в мире. Вы можете связаться со своими друзьями через коммуникаторы. Но будьте осторожны – Оверлорды не должны знать про Страну Чудес. \n\nМои первые попытки что-то оцифровать… провальные. Нужна помощь извне. Этот мальчик, Рен… он до последнего улыбался Нане. Я почти подцепила его сознание, он так сильно ее любил… так желал ей победы.\n\nЕго последние мысли. Нана … я сделаю все для тебя. Катце позаботится о тебя, я уверен, он же мой друг. Ты не будешь одна”.\n\nЕсли вас тут пятеро, нажми Продолжить`;

const pre6 = `Наша третья головоломка. Следуй за кроликом по клеткам. Ошибка — тайм-аут 30 секунд.`;

const text7 = `Страна Чудес – единственное безопасное место. Я смогу оцифровать тех, кто умрет на сцене. А потом может и всех, кто умирает … Я познакомилась с Шейдом. Он сказал, что он такой - оцифрованный человек. Он подключился к моему чипу и что-то сделал во время Alien Stage. Возможно, поэтому я смогла после смерти остаться … такой же как он?\n\nТеперь я – Белый Кролик. Ищу способы связаться с питомцами, но чипы их защищены, а я не Шейд, чтобы подключиться просто так … \n\nГодами я искала тут информацию. Как победить Оверлордов. И я поняла, что это … невозможно.\n\nСистему VIVINOUS можно отключить. Для этого надо получить коды доступа от главы Совета – Аметрина, и сделать это во время Alien Stage, начиная с полуфинала. Это же нереально, да? Поэтому только Страна Чудес, счастливая и безопасная спасет всех\n\nКакая команда нужна, чтобы остановить VIVINOS? ИМЕНЕМ ЯНТАРЯ. \n\nНо зачем это? Ведь Страна Чудес не может существовать без VIVINOS. Все кто здесь — умрут. \n\nСара, я так надеюсь, что мы встретимся здесь. Мы будем счастливы!\n\nЕсли вас тут шестеро, нажми Продолжить`;

// ---------- Утилиты ----------
function typeText(el, text, speed=18){
  return new Promise(resolve=>{
    el.textContent = '';
    let i=0; const id=setInterval(()=>{
      el.textContent += text[i++];
      if(i>=text.length){ clearInterval(id); resolve(); }
    }, speed);
  });
}
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function makeContinue(containerId, next){
  const c = document.getElementById(containerId);
  const btn = document.createElement('button');
  btn.className='btn'; btn.textContent='Продолжить';
  btn.onclick=()=>{ showScreen(next); runScreen(next); };
  c.innerHTML=''; c.appendChild(btn);
}

// ---------- Level 1 ----------
const lvl1Container = document.getElementById('lvl1');
const symbolsContainer = document.getElementById('symbols');
const msg1 = document.getElementById('msg1');
const btnCheck1 = document.getElementById('btnCheck1');
const correctOrder1 = ['🐇','😺','🫖','🕰️','♛'];
let arr1 = [];
function renderSymbols(){
  symbolsContainer.innerHTML='';
  arr1.forEach((sym, i)=>{
    const d=document.createElement('div');
    d.className='symbol'; d.textContent=sym;
    d.title='Нажмите, чтобы сдвинуть вправо';
    d.onclick=()=>{ if(i < arr1.length-1){ [arr1[i], arr1[i+1]]=[arr1[i+1],arr1[i]]; renderSymbols(); } };
    symbolsContainer.appendChild(d);
  });
}
btnCheck1.addEventListener('click', ()=>{
  if(arr1.join('') === correctOrder1.join('')){
    msg1.style.color = getComputedStyle(document.documentElement).getPropertyValue('--ok');
    msg1.textContent = 'Система разблокирована! →';
    setTimeout(()=>{ showScreen('s3'); runScreen('s3'); }, 500);
  } else {
    msg1.style.color='var(--err)'; msg1.textContent='Неверный порядок. Попробуйте снова.';
  }
});

// ---------- Level 2 ----------
const msg2 = document.getElementById('msg2');
const btnCheck2 = document.getElementById('btnCheck2');
const correctPairs = {
  'Белый кролик': 'Зеленый',
  'Чеширский кот': 'Ягодный',
  'Королева': 'Черный',
  'Безумный Шляпник': 'Мятный',
  'Мартовский Заяц': 'Лимонный'
};
btnCheck2.addEventListener('click', ()=>{
  let ok=true; const rows=[1,2,3,4,5];
  rows.forEach((i)=>{
    const guest = document.querySelector(`#s4 table tr:nth-child(${i+1}) td:first-child`).textContent;
    const val = document.getElementById(`guest${i}`).value;
    if(val !== correctPairs[guest]) ok=false;
  });
  if(ok){
    msg2.style.color='var(--ok)'; msg2.textContent='Чаепитие завершено! →';
    setTimeout(()=>{ showScreen('s5'); runScreen('s5'); }, 500);
  } else { msg2.style.color='var(--err)'; msg2.textContent='Что-то не так. Проверьте все условия.'; }
});

// ---------- Level 3 ----------
const mazeRows=5, mazeCols=5;
const correctPath = [[0,0],[1,0],[1,1],[2,1],[3,1],[3,2],[4,2],[4,3],[4,4]];
let step=0, canClick=true, intervalId=null, countdown=0;
function renderMaze(){
  const tbl=document.getElementById('maze'); tbl.innerHTML='';
  for(let r=0;r<mazeRows;r++){
    const tr=document.createElement('tr');
    for(let c=0;c<mazeCols;c++){
      const td=document.createElement('td'); td.id=`cell-${r}-${c}`; td.textContent='';
      td.onclick=()=>onCell(r,c); tr.appendChild(td);
    } tbl.appendChild(tr);
  }
}
function clearMazeVisual(){
  document.querySelectorAll('#maze td').forEach(td=>{ td.classList.remove('path','wrong'); td.textContent=''; });
}
function onCell(r,c){
  if(!canClick) return; const msg=document.getElementById('msg3');
  if(r===correctPath[step][0] && c===correctPath[step][1]){
    const cell = document.getElementById(`cell-${r}-${c}`);
    cell.classList.add('path');
    cell.textContent = '🐇';
    step++;
    if(step===correctPath.length){ msg.style.color='var(--ok)'; msg.textContent='Вы выбрались из норы! →'; setTimeout(()=>{ showScreen('s7'); runScreen('s7'); },600); }
  } else {
    clearMazeVisual();
    step=0; const wrongCell=document.getElementById(`cell-${r}-${c}`); wrongCell.classList.add('wrong');
    msg.style.color='var(--err)'; msg.textContent='Тупик. Подождите 30 секунд…';
    canClick=false; countdown=30; const timer=document.getElementById('timer'); timer.textContent=`Таймер: ${countdown}s`;
    intervalId=setInterval(()=>{ countdown--; timer.textContent=`Таймер: ${countdown}s`; if(countdown<=0){ clearInterval(intervalId); intervalId=null; canClick=true; timer.textContent=''; msg.textContent=''; clearMazeVisual(); } },1000);
  }
}

// ---------- Диалоги / Дневники ----------
function fillDiaries(){
  const d = document.getElementById('diaries'); d.innerHTML='';
  const items = [
    {title:'Страница 3', content:text3.replace(/\nЕсли вас тут четверо, нажми Продолжить$/,'')},
    {title:'Страница 5', content:text5.replace(/\nЕсли вас тут пятеро, нажми Продолжить$/,'')},
    {title:'Страница 7', content:text7.replace(/\nЕсли вас тут шестеро, нажми Продолжить$/,'')},
  ];
  items.forEach(it=>{
    const details=document.createElement('details');
    const summary=document.createElement('summary'); summary.textContent=it.title;
    const p=document.createElement('pre'); p.style.whiteSpace='pre-wrap'; p.textContent=it.content;
    details.appendChild(summary); details.appendChild(p); d.appendChild(details);
  });
}

// ---------- Раннер экранов ----------
async function runScreen(id){
  if(id==='s1'){ await typeText(document.getElementById('t1'), text1); makeContinue('c1','s2'); }

  if(id==='s2'){
    await typeText(document.getElementById('t2'), pre2+"\n\n");
    lvl1Container.style.opacity='1'; lvl1Container.style.pointerEvents='auto';
    arr1=[...correctOrder1].sort(()=>Math.random()-0.5); renderSymbols();
  }

  if(id==='s3'){ await typeText(document.getElementById('t3'), text3); makeContinue('c3','s4'); }

  if(id==='s4'){
    await typeText(document.getElementById('t4'), pre4+"\n\n");
    document.getElementById('lvl2').style.opacity='1'; document.getElementById('lvl2').style.pointerEvents='auto';
  }

  if(id==='s5'){ await typeText(document.getElementById('t5'), text5); makeContinue('c5','s6'); }

  if(id==='s6'){
    await typeText(document.getElementById('t6'), pre6+"\n\n");
    document.getElementById('lvl3').style.opacity='1'; document.getElementById('lvl3').style.pointerEvents='auto';
    renderMaze();
  }

  if(id==='s7'){ await typeText(document.getElementById('t7'), text7); makeContinue('c7','s8'); }

  if(id==='s8'){ fillDiaries(); }
}

// стартуем
runScreen('s1');
</script>
</body>
</html>
